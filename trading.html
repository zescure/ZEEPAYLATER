<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>LNX Whale Simulator + PnL</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #121212; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    h1 { margin-bottom: 20px; }
    #container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; width: 100%; max-width: 1200px; }
    #chartPanel, #controlPanel { background: #1e1e1e; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }
    #chartPanel { flex: 2 1 600px; }
    #controlPanel { flex: 1 1 350px; }
    .stat { margin: 10px 0; font-size: 15px; }
    .stat span { font-weight: bold; color: #90caf9; }
    #fakeOrder { color: #ffb74d; min-height: 1.2em; }
    #news { color: #f48fb1; margin: 12px 0; min-height: 1.5em; }
    .trade-box { display: flex; align-items: center; margin: 12px 0; }
    .trade-box input { flex: 1; padding: 8px; border: 1px solid #333; border-radius: 4px; margin-right: 8px; background: #121212; color: #e0e0e0; font-size: 14px; }
    .trade-box button { padding: 8px 16px; border: none; border-radius: 4px; background: #42a5f5; color: #fff; font-weight: bold; cursor: pointer; transition: background .2s; }
    .trade-box button:hover { background: #1e88e5; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    th, td { padding: 6px; border: 1px solid #333; text-align: left; }
    th { background: #2e2e2e; }
    footer { margin-top: 30px; font-size: 12px; color: #777; }
  </style>
</head>
<body>
  <h1>ðŸª™ LNX Whale Simulator + PnL</h1>
  <div id="container">
    <!-- Grafik Harga -->
    <div id="chartPanel">
      <canvas id="priceChart"></canvas>
    </div>
    <!-- Panel Kontrol & Info -->
    <div id="controlPanel">
      <div class="stat">Harga LNX: <span id="priceDisplay"></span></div>
      <div class="stat">Pool: <span id="poolInfo"></span></div>
      <div class="stat">Saldo Lu: <span id="userInfo"></span></div>
      <div class="stat">Unrealized PnL: <span id="unrealizedPnL"></span></div>
      <div class="stat">Realized PnL: <span id="realizedPnL"></span></div>
      <div class="stat" id="fakeOrder">Fake Order: â€”</div>
      <div class="stat" id="news"></div>
      <hr style="border-color: #333; margin: 12px 0;">
      <div class="trade-box">
        <input type="number" id="buyInput" placeholder="Masukkan LNX beli">
        <button onclick="buyLNX()">BUY</button>
      </div>
      <div class="trade-box">
        <input type="number" id="sellInput" placeholder="Masukkan LNX jual">
        <button onclick="sellLNX()">SELL</button>
      </div>
      <hr style="border-color: #333; margin: 12px 0;">
      <div class="stat"><strong>Top 5 Whales</strong></div>
      <table>
        <thead>
          <tr><th>Whale</th><th>Holdings</th><th>PnL</th></tr>
        </thead>
        <tbody id="whaleTable"></tbody>
      </table>
    </div>
  </div>
  <footer>Simulasi AMM â€¢ supply 21â€¯jt LNX â€¢ Whale PnL & Alerts â€¢ by Lionor AI Beta</footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // --- Parameter Awal ---
    const totalSupply = 21_000_000;
    const whaleThreshold = 500_000;
    let userLNX        = 1_000_000,
        userRp         = 1_000_000_000,
        poolLNX        = totalSupply - userLNX,
        initialPrice   = 100,
        poolRp         = poolLNX * initialPrice,
        price          = initialPrice;

    // User cost basis & realized PnL
    let userCostBasis  = userLNX * initialPrice,
        userRealizedPnL = 0;

    // Top 5 whales static
    const whales = [
      { name:'Whale A', lnx: 2_500_000, cost:2_500_000*initialPrice },
      { name:'Whale B', lnx: 2_000_000, cost:2_000_000*initialPrice },
      { name:'Whale C', lnx: 1_800_000, cost:1_800_000*initialPrice },
      { name:'Whale D', lnx: 1_500_000, cost:1_500_000*initialPrice },
      { name:'Whale E', lnx: 1_200_000, cost:1_200_000*initialPrice }
    ];

    const fakeNames = ['Alice','Bob','Charlie','Doni','Siti','Andi','Rina','Budi','Wati','Chandra'];

    // Chart.js init
    const ctx = document.getElementById('priceChart').getContext('2d');
    const chartData = {
      labels: Array(30).fill(''),
      datasets: [{ label: 'Harga LNX (Rp)', data: Array(30).fill(price), borderColor: '#42a5f5', tension: 0.3, pointRadius: 0 }]
    };
    const priceChart = new Chart(ctx, { type:'line', data:chartData, options:{ animation:false, scales:{ x:{ display:false }, y:{ ticks:{ color:'#90caf9' } } } } });

    // Format Rupiah
    function fmtRp(x) { return 'Rp'+x.toLocaleString('id-ID',{minimumFractionDigits:2}); }

    // Render data UI
    function render() {
      // clamp pools
      poolLNX = Math.min(Math.max(poolLNX,0), totalSupply);
      poolRp  = Math.max(poolRp,0);
      price   = Math.max(poolRp/poolLNX || 0,0.01);

      // User PnL
      const unrealized = userLNX*price - userCostBasis;
      // update UI
      document.getElementById('priceDisplay').innerText   = fmtRp(price);
      document.getElementById('poolInfo').innerText      = `${poolLNX.toLocaleString()} LNX / ${fmtRp(poolRp)}`;
      document.getElementById('userInfo').innerText      = `${userLNX.toLocaleString()} LNX / ${fmtRp(userRp)}`;
      document.getElementById('unrealizedPnL').innerText = fmtRp(unrealized);
      document.getElementById('realizedPnL').innerText   = fmtRp(userRealizedPnL);

      // update chart
      priceChart.data.datasets[0].data.push(price);
      priceChart.data.datasets[0].data.shift();
      priceChart.update();

      // update whale table
      const tbody = document.getElementById('whaleTable');
      tbody.innerHTML = '';
      whales.forEach(w => {
        const pnl = w.lnx*price - w.cost;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${w.name}</td><td>${w.lnx.toLocaleString()} LNX</td><td>${fmtRp(pnl)}</td>`;
        tbody.appendChild(tr);
      });
    }

    // Fake market noise + fake order
    function marketNoise() {
      const noisePct = (Math.random()-0.5)*0.02;
      const deltaRp  = poolRp*noisePct;
      const action   = noisePct>0?'BUY':'SELL';
      const name     = fakeNames[Math.floor(Math.random()*fakeNames.length)];
      const amtRp    = Math.abs(deltaRp), amtLNX=amtRp/price;
      if (action==='BUY' && poolLNX>=amtLNX) {
        poolRp+=amtRp; poolLNX-=amtLNX;
      } else if (action==='SELL' && poolRp>=amtRp) {
        poolRp-=amtRp; poolLNX+=amtLNX;
      }
      document.getElementById('fakeOrder').innerText=
        `Fake Order: ${name} ${action} ${amtLNX.toFixed(0)} LNX`;
    }

    // Fake news generator
    function showNews(type, amt) {
      const fmtAmt = amt.toLocaleString();
      const impact=type==='BUY'?'optimis, harga naik!':'panik, harga turun tajam!';
      const cls = type==='BUY'?'pos':'neg';
      const el = document.getElementById('news');
      el.innerText=`Berita ${type==='BUY'?'Positif':'Negatif'}: Founder ${type.toLowerCase()} ${fmtAmt} LNX, pasar ${impact}`;
      el.className = cls;
      setTimeout(()=>el.innerText='',5000);
    }

    // User buy
    function buyLNX() {
      const amt = parseFloat(document.getElementById('buyInput').value);
      if(!amt||amt<=0) return alert('Jumlah beli tidak valid!');
      if(poolLNX<amt) return alert('Supply LNX tidak cukup!');
      const cost = amt*price;
      if(userRp<cost) return alert('Saldo Rp tidak cukup!');
      // exec
      userRp   -= cost; poolRp += cost;
      // cost basis & holdings
      userCostBasis += cost; userLNX += amt; poolLNX -= amt;
      if(amt>=whaleThreshold) showNews('BUY',amt);
      render();
    }

    // User sell
    function sellLNX() {
      const amt=parseFloat(document.getElementById('sellInput').value);
      if(!amt||amt<=0) return alert('Jumlah jual tidak valid!');
      if(userLNX<amt) return alert('Token LNX tidak cukup!');
      const gain=amt*price;
      if(poolRp<gain) return alert('Pool Rp tidak cukup!');
      // realized PnL
      const costRemoved = userCostBasis*(amt/(userLNX));
      userRealizedPnL += gain - costRemoved;
      userCostBasis   -= costRemoved;
      // exec
      userRp   += gain; poolRp -= gain;
      userLNX  -= amt; poolLNX += amt;
      if(amt>=whaleThreshold) showNews('SELL',amt);
      render();
    }

    // Loop update
    setInterval(()=>{ marketNoise(); render(); },1000);
    render();
  </script>
</body>
</html>
