<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>LNX Realistic Exchange Simulator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #0a0a0a;
      color: #0cffb3;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 { color: #fff; }
    #container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    #chartPanel, #controlPanel {
      background: #101010;
      padding: 20px;
      border-radius: 8px;
    }
    #chartPanel { width: 600px; }
    #controlPanel { width: 300px; }
    .stat { margin: 10px 0; }
    input { width: 100px; padding: 5px; margin-right: 5px; }
    button {
      padding: 8px 16px;
      margin: 5px 0;
      background: #0cffb3;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #0aaa82; }
  </style>
</head>
<body>
  <h1>ðŸª™ LNX Realistic Simulator</h1>
  <div id="container">
    <!-- Grafik Harga -->
    <div id="chartPanel">
      <canvas id="priceChart"></canvas>
    </div>
    <!-- Panel Kontrol -->
    <div id="controlPanel">
      <div class="stat" id="priceDisplay">Harga LNX: </div>
      <div class="stat" id="poolInfo">Pool: </div>
      <div class="stat" id="userInfo">Lu: </div>
      <hr>
      <div>
        <input type="number" id="buyInput" placeholder="LNX mau beli">
        <button onclick="buyLNX()">BUY</button>
      </div>
      <div>
        <input type="number" id="sellInput" placeholder="LNX mau jual">
        <button onclick="sellLNX()">SELL</button>
      </div>
      <button onclick="rugpull()">Withdraw All BNB (Rugpull!)</button>
    </div>
  </div>

  <script>
    // --- Parameter Awal ---
    const totalSupply = 1_000_000;
    let userLNX = totalSupply * 0.5;      
    let userBNB = 100;                   // Saldo user
    let poolLNX = totalSupply * 0.5;     // Pool = 500k LNX
    let poolBNB = 100;                   // Pool = 100 BNB
    let price = poolBNB / poolLNX;       // Harga awal

    // Chart.js setup
    const ctx = document.getElementById('priceChart').getContext('2d');
    const data = {
      labels: Array(30).fill(''),
      datasets: [{
        label: 'Harga LNX (BNB per LNX)',
        data: Array(30).fill(price),
        borderColor: '#0cffb3',
        tension: 0.3,
        pointRadius: 0
      }]
    };
    const config = {
      type: 'line',
      data,
      options: {
        animation: false,
        scales: {
          x: { display: false },
          y: { ticks: { color: '#0cffb3' } }
        }
      }
    };
    const priceChart = new Chart(ctx, config);

    // Helper formatting
    function fmt(num, fixed=4) { return num.toFixed(fixed); }

    // Update tampilan & chart
    function render() {
      price = poolBNB / poolLNX;
      document.getElementById('priceDisplay').innerText = 
        `Harga LNX: ${fmt(price)} BNB`;
      document.getElementById('poolInfo').innerText = 
        `Pool â†’ ${fmt(poolBNB)} BNB / ${fmt(poolLNX)} LNX`;
      document.getElementById('userInfo').innerText = 
        `Lu â†’ ${fmt(userBNB)} BNB / ${fmt(userLNX)} LNX`;

      // geser chart
      priceChart.data.labels.push('');
      priceChart.data.labels.shift();
      priceChart.data.datasets[0].data.push(price);
      priceChart.data.datasets[0].data.shift();
      priceChart.update();
    }

    // Noise pasar tiap detik
    function marketNoise() {
      const noiseLNX = (Math.random() - 0.5) * 100; // Â±50 LNX
      // beli atau jual noise dari pool
      if (noiseLNX > 0 && poolLNX > noiseLNX) {
        // fake buyer
        poolLNX -= noiseLNX;
        poolBNB += noiseLNX * price;
      } else if (noiseLNX < 0) {
        // fake seller
        const sellAmt = Math.min(poolLNX * 0.2, -noiseLNX);
        poolLNX += sellAmt;
        poolBNB -= sellAmt * price;
      }
    }

    // Aksi user
    function buyLNX() {
      const amt = parseFloat(document.getElementById('buyInput').value);
      if (!amt || amt <= 0) return alert('Masukin jumlah valid!');
      const cost = amt * price;
      if (userBNB < cost || poolLNX < amt) 
        return alert('Saldo/pool nggak cukup!');
      userBNB -= cost; poolBNB += cost;
      userLNX += amt; poolLNX -= amt;
      render();
    }
    function sellLNX() {
      const amt = parseFloat(document.getElementById('sellInput').value);
      if (!amt || amt <= 0) return alert('Jumlah jual invalid!');
      if (userLNX < amt) return alert('Token lu kagak cukup!');
      const gain = amt * price;
      userLNX -= amt; poolLNX += amt;
      userBNB += gain; poolBNB -= gain;
      render();
    }

    // Rugpull: ambil semua BNB dari pool
    function rugpull() {
      userBNB += poolBNB;
      poolBNB = 0;
      render();
      alert('RUGPULL! Pool BNB = 0 â†’ harga = 0! Token nyangkut.');
    }

    // Loop update
    setInterval(() => {
      marketNoise();
      render();
    }, 1000);

    // Inisialisasi tampilan
    render();
  </script>
</body>
</html>
